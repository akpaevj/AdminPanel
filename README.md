# AdminPanel

Небольшой сайт с http-сервисом для управления списками баз для пользователей домена (доступна загрузка списка пользователей из каталога AD). Резализует интерфейс сервиса (WebCommonInfoBases), описанный на ИТС. При корректной настройке, пользователь 1С при запуске 1cestart.exe будет получать актуальный список баз. Сайт жестко завязан на службу каталогов, поэтому ручное создание пользователей недоступно.

<h2>How to use:</h2>

IIS:
1. Скачать архив с последней версией релиза по адресу https://github.com/akpaevj/AdminPanel/releases
2. Создать папку, в которой будут располагаться файлы сайта (для примера назовем ее AdminPanel) и распаковать скачанный архив в эту папку.
3. В панели управления IIS создать новый сайт (для примера назовем его wcib.enterprise.corp, так-же необходимо создать A-записи в DNS и выполнить привязку сайта)
4. В физическом пути сайта указываем папку, созданную на шаге 2.
5. <b>В настройках проверки подлинности сайта включаем Анонимную проверку подлинности и Проверку подлинности Windows (здесь есть расхождения с инструкцией с ИТС, нет необходимости делать разные сайты и публикации для анонимных и аутентифицированных пользователей)</b>
6. В папке сайта находим файл appsettings.json и меняем значения параметров на свои:
  - В параметре Default в секции ConnectionStrings указываем строку подключения к базе данных. Встроенная проверка пользователя работать не будет при стандартных настройках сайта, меняем Integrated Security на параметры User ID и Password, указываем адрес сервера базы данных. <b>Базу данных создавать вручную не нужно. Пользователь, указанный в настройках, должен иметь права на создание базы данных, она будет создана автоматически</b>
  - В параметре AdminGroup секции Security указываем группу домена в формате DOMAIN_NAME\\GROUP_NAME, членам которой будет доступна административная панель сайта (эту группу нужно будет создать и включить туда пользователей-администраторов списков ИБ).
  - В параметре UserGroup секции Security указываем группу домена в формате DOMAIN_NAME\\GROUP_NAME, членам которой будет доступно получение списка баз из http-сервиса

Пример содержимого appsettings.json:

``` json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "Default": "Data Source=localhost;Initial Catalog=AdminPanel;User ID=username;Password=12345;"
  },
  "Security": {
    "AdminGroup": "CONTOSO\\Администраторы 1С",
    "UserGroup":  "CONTOSO\\Пользователи домена"
  }
}
```

Для начала использования http-сервиса WebCommonInfoBases необходимо в файле 1cestart.cfg заполнить параметр InternetService, указав в значении адрес сайта, либо интерактивно добавить сайт в адреса списков общих информационных баз.

![Alt text](/Users.png)
![Alt text](/InfoBasesLists.png)
![Alt text](/InfoBases.png)
